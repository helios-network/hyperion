<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hyperion Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">
    <style>
        [v-cloak] {
            display: none;
        }
        .chain-card {
            margin-bottom: 16px;
        }
        .grp-status {
            display: flex ;
            flex-direction: column;
            gap: 5px;
        }
        .container {
            max-width: 100%;
        }
    </style>
</head>
<body>
    <div id="app" v-cloak>
        <v-app>
            <!-- Login Page -->
            <v-container v-if="!isAuthenticated" fluid class="fill-height">
                <v-row align="center" justify="center">
                    <v-col cols="12" sm="8" md="4">
                        <v-card class="elevation-12">
                            <v-toolbar color="primary" dark flat>
                                <v-toolbar-title>Hyperion Login</v-toolbar-title>
                            </v-toolbar>
                            <v-card-text>
                                <v-form @submit.prevent="login">
                                    <v-text-field
                                        v-model="password"
                                        :append-icon="showPassword ? 'mdi-eye' : 'mdi-eye-off'"
                                        :type="showPassword ? 'text' : 'password'"
                                        label="Password"
                                        @click:append="showPassword = !showPassword"
                                    ></v-text-field>
                                    <v-alert v-if="error" type="error" dense>
                                        {{ error }}
                                    </v-alert>
                                </v-form>
                            </v-card-text>
                            <v-card-actions>
                                <v-spacer></v-spacer>
                                <v-btn color="primary" @click="login">Login</v-btn>
                            </v-card-actions>
                        </v-card>
                    </v-col>
                </v-row>
            </v-container>

            <!-- Dashboard -->
            <v-container v-else-if="!showTokensPage && !showRpcsPage && !showSettingsPage && !showGovernancePage">
                <v-row>
                    <v-col class="col col-12">
                        <v-card>
                            <v-card-title class="d-flex align-center">
                                <div>Hyperion Chains</div>
                                <v-spacer></v-spacer>
                                <v-tooltip bottom>
                                    <template v-slot:activator="{ on, attrs }">
                                        <div 
                                            class="text-subtitle-2 grey--text mr-4" 
                                            v-bind="attrs" 
                                            v-on="on"
                                            style="cursor: pointer"
                                            @click="copyToClipboard(walletAddress)"
                                        >
                                            {{ walletAddress }}
                                        </div>
                                    </template>
                                    Click to copy address
                                </v-tooltip>
                                <v-btn color="primary" @click="showAddChainDialog = true">
                                    Add Chain
                                </v-btn>
                                <span class="mr-2"></span>
                                <v-btn color="info" @click="showGovernancePage = true">
                                    Governance
                                </v-btn>
                            </v-card-title>
                            <v-card-text>
                                <v-row>
                                    <v-col v-for="(chain, id) in chains" :key="id" cols="12" md="6" lg="3">
                                        <v-card class="chain-card">
                                            <v-card-text>
                                                <div class="text-h6 mb-2">Chain ID: {{ chain.chainId }}</div>
                                                <v-list dense>
                                                    <v-list-item v-if="chain.name !== undefined">
                                                        <v-list-item-content>
                                                            <v-list-item-title>Name</v-list-item-title>
                                                            <v-list-item-subtitle>{{ chain.name }}</v-list-item-subtitle>
                                                        </v-list-item-content>
                                                    </v-list-item>
                                                    <v-list-item>
                                                        <v-list-item-content>
                                                            <v-list-item-title>Address</v-list-item-title>
                                                            <v-list-item-subtitle>{{ chain.address }}</v-list-item-subtitle>
                                                            <v-list-item-title v-if="chain.oldAddress !== undefined">Old Address</v-list-item-title>
                                                            <v-list-item-subtitle v-if="chain.oldAddress !== undefined">{{ chain.oldAddress }}</v-list-item-subtitle>
                                                        </v-list-item-content>
                                                    </v-list-item>
                                                    <v-list-item>
                                                        <v-list-item-content>
                                                            <v-list-item-title>Status</v-list-item-title>
                                                            <v-list-item-subtitle class="grp-status">
                                                                <v-chip
                                                                    :color="chain.running ? 'success' : 'error'"
                                                                    small
                                                                >
                                                                    {{ chain.running ? 'Running' : 'Stopped' }}
                                                                </v-chip>
                                                                <v-chip
                                                                    :color="chain.registered ? 'success' : 'warning'"
                                                                    small
                                                                >
                                                                    {{ chain.registered ? 'Registered' : 'Unregistered' }}
                                                                </v-chip>
                                                                <v-chip
                                                                    v-if="chain.paused"
                                                                    color="warning"
                                                                    small
                                                                >
                                                                    Paused
                                                                </v-chip>
                                                                <v-chip
                                                                    :color="!chain.paused && chain.isSynced ? 'success' : 'error'"
                                                                    small
                                                                >
                                                                    {{ chain.isSynced ? 'Synced' : 'Out of Sync' }}
                                                                </v-chip>
                                                            </v-list-item-subtitle>
                                                        </v-list-item-content>
                                                    </v-list-item>
                                                    <v-list-item v-if="chain.height > 0">
                                                        <v-list-item-content>
                                                            <v-list-item-title>Sync Status</v-list-item-title>
                                                            <v-list-item-subtitle>
                                                                Height: {{ chain.height }} | Target: {{ chain.targetHeight }} | Diff: {{ chain.heightDiff }}
                                                            </v-list-item-subtitle>
                                                            <v-list-item-title>Stats</v-list-item-title>
                                                            <v-list-item-subtitle class="grp-status">
                                                                <v-chip color="primary" small>
                                                                    Total Txs: {{ chain.totalTxs }}
                                                                </v-chip>
                                                                <v-chip color="primary" small>
                                                                    Batches: {{ chain.batches }}
                                                                </v-chip>
                                                                <v-chip color="primary" small> 
                                                                    Out Bridged Txs: {{ chain.outBridgedTxCount }}
                                                                </v-chip>
                                                                <v-chip color="primary" small>
                                                                    In Bridged Txs: {{ chain.inBridgedTxCount }}
                                                                </v-chip>
                                                            </v-list-item-subtitle>
                                                            <v-list-item-title>States</v-list-item-title>
                                                            <v-list-item-subtitle class="grp-status">
                                                                <v-chip
                                                                    v-for="state in chain.states"
                                                                    :key="state.name"
                                                                    :color="state.value !== 'idle' ? 'success' : 'error'"
                                                                    small
                                                                >
                                                                    {{ state.name }}: {{ state.value }} {{ state.value === 'idle' ? `(Next: ${state.nextExecutionTimestamp}, Last: ${state.lastExecutionFinishedTimestamp})` : '' }}
                                                                </v-chip>

                                                            </v-list-item-subtitle>
                                                        </v-list-item-content>
                                                    </v-list-item>
                                                </v-list>
                                                <v-card-actions>
                                                    <v-spacer></v-spacer>
                                                    <v-btn
                                                        v-if="!chain.running && chain.proposed && chain.registered"
                                                        color="success"
                                                        @click="runHyperion(chain.chainId)"
                                                        :loading="chain.isLoading"
                                                    >
                                                        Run
                                                    </v-btn>
                                                    <v-btn
                                                        v-if="chain.running"
                                                        color="error"
                                                        @click="stopHyperion(chain.chainId)"
                                                        :loading="chain.isLoading"
                                                    >
                                                        Stop
                                                    </v-btn>
                                                    <v-btn
                                                        v-if="chain.registered && !chain.running"
                                                        color="warning"
                                                        @click="unregisterHyperion(chain.chainId)"
                                                        :loading="chain.isLoading"
                                                        class="ml-2"
                                                    >
                                                        Unregister
                                                    </v-btn>
                                                    <v-btn
                                                        v-if="!chain.registered && chain.proposed"
                                                        color="info"
                                                        @click="registerHyperion(chain.chainId)"
                                                        :loading="chain.isLoading"
                                                        class="ml-2"
                                                    >
                                                        Register
                                                    </v-btn>
                                                    <v-btn
                                                        color="info"
                                                        @click="selectedChainId = chain.chainId; showOthersModal = true"
                                                        class="ml-2"
                                                    >
                                                        Others
                                                    </v-btn>
                                                </v-card-actions>
                                            </v-card-text>
                                        </v-card>
                                    </v-col>
                                </v-row>
                            </v-card-text>
                        </v-card>
                    </v-col>
                </v-row>

                <!-- Other Actions Modal -->
                <v-dialog v-model="showOthersModal" max-width="500px">
                    <v-card>
                        <v-card-title>Other Actions for Chain {{ selectedChainId }}</v-card-title>
                        <v-card-text>
                            <v-card-actions class="d-flex flex-column">
                                <v-row>
                                    <v-col cols="12">
                                        <v-btn
                                            color="success"
                                            @click="createHyperionContract(selectedChainId); showOthersModal = false;"
                                            :loading="isCreatingHyperionContract"
                                            block
                                        >
                                            Deploy Hyperion Contract
                                        </v-btn>
                                    </v-col>
                                    <v-col cols="12">
                                        <v-btn
                                            v-if="!chains.find(chain => chain.chainId === selectedChainId)?.proposed && chains.find(chain => chain.chainId === selectedChainId)?.address !== '0x0000000000000000000000000000000000000000'"
                                            color="primary"
                                            @click="openProposeDialog(selectedChainId); showOthersModal = false;"
                                            :loading="chains.find(chain => chain.chainId === selectedChainId)?.isLoading"
                                            block
                                        >
                                            Propose
                                        </v-btn>
                                    </v-col>
                                    <v-col cols="12">
                                        <v-btn
                                            v-if="!chains.find(chain => chain.chainId === selectedChainId)?.proposed && chains.find(chain => chain.chainId === selectedChainId)?.type === 'update'"
                                            color="info"
                                            @click="openProposeUpdateDialog(selectedChainId); showOthersModal = false;"
                                            :loading="chains.find(chain => chain.chainId === selectedChainId)?.isLoading"
                                            block
                                        >
                                            Propose Update
                                        </v-btn>
                                    </v-col>
                                    <v-col cols="12">
                                        <v-btn
                                            v-if="chains.find(chain => chain.chainId === selectedChainId)?.proposed"
                                            color="info"
                                            @click="viewTokens(selectedChainId); showOthersModal = false;"
                                            block
                                        >
                                            Tokens
                                        </v-btn>
                                    </v-col>
                                    <v-col cols="12">
                                        <v-btn
                                            color="info"
                                            @click="viewRpcs(selectedChainId); showOthersModal = false;"
                                            block
                                        >
                                            RPCs
                                        </v-btn>
                                    </v-col>
                                    <v-col cols="12">
                                        <v-btn
                                            color="info"
                                            @click="viewSettings(selectedChainId); showOthersModal = false;"
                                            block
                                        >
                                            Chain Settings
                                        </v-btn>
                                    </v-col>
                                    <v-col cols="12">
                                        <v-btn
                                            color="info"
                                            @click="openProposeAddWhitelistedAddressDialog(selectedChainId); showOthersModal = false;"
                                            block
                                        >
                                            Propose Add Whitelisted Address
                                        </v-btn>
                                    </v-col>
                                    <v-col cols="12">
                                        <v-btn
                                            color="info"
                                            @click="openUpdateChainLogoDialog(selectedChainId); showOthersModal = false;"
                                            block
                                        >
                                            Update Logo
                                        </v-btn>
                                    </v-col>
                                </v-row>
                            </v-card-actions>
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn color="error" text @click="showOthersModal = false">Close</v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>

                <!-- Transactions Table -->
                <v-row class="mt-4">
                    <v-col cols="12">
                        <v-card>
                            <v-card-title>
                                Recent Transactions
                            </v-card-title>
                            <v-card-text>
                                <v-data-table
                                    :headers="[
                                        { text: 'Chain ID', value: 'chain_id' },
                                        { text: 'Type', value: 'tx_type' },
                                        { text: 'Transaction Hash', value: 'tx_hash' },
                                        { text: 'Block Height', value: 'block_height' },
                                        { text: 'Token Contract', value: 'token_contract' },
                                        { text: 'Cost', value: 'cost' },
                                        { text: 'Fees Taken', value: 'fees_taken' },
                                        { text: 'Timestamp', value: 'timestamp' }
                                    ]"
                                    :items="transactions"
                                    :loading="isLoadingTransactions"
                                    :options.sync="transactionTableOptions"
                                    :server-items-length="totalTransactions"
                                    :footer-props="{
                                        'items-per-page-options': [5, 10, 20, 50],
                                        showFirstLastPage: true
                                    }"
                                >
                                    <template v-slot:item.tx_hash="{ item }">
                                        <v-tooltip bottom>
                                            <template v-slot:activator="{ on, attrs }">
                                                <span v-bind="attrs" v-on="on">{{ item.tx_hash }}</span>
                                            </template>
                                            <v-btn
                                                text
                                                small
                                                @click="copyToClipboard(item.tx_hash)"
                                            >
                                                Click to copy
                                            </v-btn>
                                        </v-tooltip>
                                    </template>
                                    <template v-slot:item.token_contract="{ item }">
                                        <v-tooltip bottom>
                                            <template v-slot:activator="{ on, attrs }">
                                                <span v-bind="attrs" v-on="on">{{ item.token_contract }}</span>
                                            </template>
                                            <v-btn
                                                text
                                                small
                                                @click="copyToClipboard(item.token_contract)"
                                            >
                                                Click to copy
                                            </v-btn>
                                        </v-tooltip>
                                    </template>
                                </v-data-table>
                            </v-card-text>
                        </v-card>
                    </v-col>
                </v-row>

                <!-- Update Chain Logo Dialog -->
                <v-dialog v-model="showUpdateChainLogoDialog" max-width="500px">
                    <v-card>
                        <v-card-title>Update Chain Logo for Chain ID: {{ selectedChainId }}</v-card-title>
                        <v-card-text>
                            <v-text-field
                                v-model="updateChainLogoHash"
                                label="Logo Hash"
                                required
                            ></v-text-field>
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn color="blue darken-1" text @click="showUpdateChainLogoDialog = false">Cancel</v-btn>
                            <v-btn color="blue darken-1" text @click="updateChainLogo">Update</v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>

                <!-- Add Chain Dialog -->
                <v-dialog v-model="showAddChainDialog" max-width="500px">
                    <v-card>
                        <v-card-title>Add New Chain</v-card-title>
                        <v-card-text>
                            <v-text-field
                                v-model="newChainId"
                                label="Chain ID"
                                type="number"
                            ></v-text-field>
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn color="error" text @click="showAddChainDialog = false">Cancel</v-btn>
                            <v-btn 
                                color="primary" 
                                @click="addNewChain"
                                :loading="isAddingChain"
                                :disabled="isAddingChain"
                            >
                                Add
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>

                <!-- Propose Hyperion Dialog -->
                <v-dialog v-model="showProposeDialog" max-width="600px">
                    <v-card>
                        <v-card-title>Propose Hyperion</v-card-title>
                        <v-card-text>
                            <v-form ref="proposeForm">
                                <v-text-field
                                    v-model="proposeForm.title"
                                    label="Title"
                                    required
                                    :rules="[v => !!v || 'Title is required']"
                                ></v-text-field>
                                <v-textarea
                                    v-model="proposeForm.description"
                                    label="Description"
                                    required
                                    :rules="[v => !!v || 'Description is required']"
                                ></v-textarea>
                                <v-text-field
                                    v-model="proposeForm.bridge_chain_id"
                                    label="Bridge Chain ID"
                                    type="number"
                                    disabled
                                ></v-text-field>
                                <v-text-field
                                    v-model="proposeForm.bridge_chain_name"
                                    label="Bridge Chain Name"
                                    required
                                    :rules="[v => !!v || 'Bridge Chain Name is required']"
                                ></v-text-field>
                                <v-text-field
                                    v-model="proposeForm.average_counterparty_block_time"
                                    label="Average Block Time (ms)"
                                    type="number"
                                    required
                                    :rules="[
                                        v => !!v || 'Block time is required',
                                        v => v > 0 || 'Block time must be positive'
                                    ]"
                                ></v-text-field>
                            </v-form>
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn color="error" text @click="showProposeDialog = false">Cancel</v-btn>
                            <v-btn color="primary" @click="proposeHyperion" :loading="isProposing">
                                Propose
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>

                <!-- Propose Hyperion Update Dialog -->
                <v-dialog v-model="showProposeUpdateDialog" max-width="600px">
                    <v-card>
                        <v-card-title>Propose Hyperion Update</v-card-title>
                        <v-card-text>
                            <v-form ref="proposeUpdateForm">
                                <v-text-field
                                    v-model="proposeForm.title"
                                    label="Title"
                                    required
                                    :rules="[v => !!v || 'Title is required']"
                                ></v-text-field>
                                <v-textarea
                                    v-model="proposeForm.description"
                                    label="Description"
                                    required
                                    :rules="[v => !!v || 'Description is required']"
                                ></v-textarea>
                                <v-text-field
                                    v-model="proposeForm.bridge_chain_id"
                                    label="Bridge Chain ID"
                                    type="number"
                                    disabled
                                ></v-text-field>
                                <v-text-field
                                    v-model="proposeForm.bridge_chain_name"
                                    label="Bridge Chain Name"
                                    required
                                    :rules="[v => !!v || 'Bridge Chain Name is required']"
                                ></v-text-field>
                                <v-text-field
                                    v-model="proposeForm.average_counterparty_block_time"
                                    label="Average Block Time (ms)"
                                    type="number"
                                    required
                                    :rules="[
                                        v => !!v || 'Block time is required',
                                        v => v > 0 || 'Block time must be positive'
                                    ]"
                                ></v-text-field>
                            </v-form>
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn color="error" text @click="showProposeUpdateDialog = false">Cancel</v-btn>
                            <v-btn color="primary" @click="proposeHyperionUpdate" :loading="isProposingUpdate">
                                Propose Update
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>

                <!-- Propose Add Whitelisted Address Dialog -->
                <v-dialog v-model="showProposeAddWhitelistedAddressDialog" max-width="600px">
                    <v-card>
                        <v-card-title>Propose Add Whitelisted Address</v-card-title>
                        <v-card-text>
                            <v-form ref="proposeAddWhitelistedAddressForm">
                                <v-text-field
                                    v-model="proposeAddWhitelistedAddressForm.title"
                                    label="Title"
                                    required
                                    :rules="[v => !!v || 'Title is required']"
                                ></v-text-field>
                                <v-textarea
                                    v-model="proposeAddWhitelistedAddressForm.description"
                                    label="Description"
                                    required
                                    :rules="[v => !!v || 'Description is required']"
                                ></v-textarea>
                                <v-text-field
                                    v-model="proposeAddWhitelistedAddressForm.chain_id"
                                    label="Chain ID"
                                    type="number"
                                    disabled
                                ></v-text-field>
                                <v-text-field
                                    v-model="proposeAddWhitelistedAddressForm.address"
                                    label="Address"
                                    required
                                    :rules="[v => !!v || 'Address is required']"
                                ></v-text-field>
                            </v-form>
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn color="error" text @click="showProposeAddWhitelistedAddressDialog = false">Cancel</v-btn>
                            <v-btn color="primary" @click="proposeAddWhitelistedAddress" :loading="isProposingAddWhitelistedAddress">
                                Propose
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>

            </v-container>

            <!-- RPCs Page -->
            <v-container v-else-if="showRpcsPage">
                <v-row>
                    <v-col cols="12">
                        <v-card>
                            <v-card-title>
                                RPCs for Chain {{ selectedChainId }}
                                <v-spacer></v-spacer>
                                <v-btn color="primary" @click="showAddRpcsDialog = true">
                                    Add RPCs
                                </v-btn>
                                <v-btn color="secondary" class="ml-2" @click="showRpcsPage = false">
                                    Back to Chains
                                </v-btn>
                            </v-card-title>
                            <v-card-text>
                                <v-data-table
                                    :headers="[
                                        { text: 'RPC URL', value: 'url' },
                                        { text: 'Is Tested', value: 'is_tested' },
                                        { text: 'Is Primary', value: 'is_primary' },
                                        { text: 'Actions', value: 'actions', sortable: false },
                                    ]"
                                    :items="rpcs"
                                    :loading="isLoadingRpcs"
                                >
                                    <template v-slot:item.url="{ item }">
                                        <v-tooltip bottom>
                                            <template v-slot:activator="{ on, attrs }">
                                                <span v-bind="attrs" v-on="on">{{ item.url }}</span>
                                            </template>
                                            <v-btn
                                                text
                                                small
                                                @click="copyToClipboard(item.url)"
                                            >
                                                Click to copy
                                            </v-btn>
                                        </v-tooltip>
                                    </template>
                                    <template v-slot:item.is_primary="{ item }">
                                        <v-icon :color="item.is_primary ? 'success' : 'error'">
                                            {{ item.is_primary ? 'mdi-check-circle' : 'mdi-close-circle' }}
                                        </v-icon>
                                    </template>
                                    <template v-slot:item.actions="{ item }">
                                        <v-btn
                                            v-if="!item.is_primary"
                                            color="primary"
                                            small
                                            @click="setPrimaryRpc(item.url)"
                                            :loading="isSettingPrimaryRpc === item.url"
                                            :disabled="isSettingPrimaryRpc !== null && isSettingPrimaryRpc !== item.url"
                                        >
                                            Set as Primary
                                        </v-btn>
                                        <v-btn
                                            color="error"
                                            small
                                            @click="removeRpc(item.url)"
                                            :loading="isDeletingRpc === item.url"
                                            :disabled="isDeletingRpc !== null && isDeletingRpc !== item.url"
                                        >
                                            Remove
                                        </v-btn>
                                    </template>
                                </v-data-table>
                            </v-card-text>
                        </v-card>
                    </v-col>
                </v-row>

                <!-- Add RPCs Dialog -->
                <v-dialog v-model="showAddRpcsDialog" max-width="500px">
                    <v-card>
                        <v-card-title>Add New RPCs</v-card-title>
                        <v-card-text>
                            <v-form ref="rpcsForm">
                                <v-textarea
                                    v-model="newRpcs"
                                    label="RPCs (rpc1,rpc2,rpc3)"
                                    hint="Enter RPCs separated by commas"
                                    persistent-hint
                                    required
                                    :rules="[v => !!v || 'At least one RPC is required']"
                                ></v-textarea>
                            </v-form>
                        </v-card-text>
                        <v-card-text>
                            <v-checkbox v-model="isPrimary" label="Set as Primary" />
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn color="error" text @click="showAddRpcsDialog = false">Cancel</v-btn>
                            <v-btn 
                                color="primary" 
                                @click="addRpcs"
                                :loading="isAddingRpcs"
                            >
                                Add
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>
            </v-container>

            <!-- Tokens Page -->
            <v-container v-else-if="showTokensPage">
                <v-row>
                    <v-col cols="12">
                        <v-card>
                            <v-card-title>
                                Tokens for Chain {{ selectedChainId }}
                                <v-spacer></v-spacer>
                                <v-btn color="primary" @click="showAddTokenDialog = true">
                                    Add Token
                                </v-btn>
                                <v-btn color="secondary" class="ml-2" @click="showTokensPage = false">
                                    Back to Chains
                                </v-btn>
                            </v-card-title>
                            <v-card-text>
                                <v-data-table
                                    :headers="[
                                        { text: 'Name', value: 'name' },
                                        { text: 'Symbol', value: 'symbol' },
                                        { text: 'Decimals', value: 'decimals' },
                                        { text: 'Contract Address', value: 'contract_address' },
                                        { text: 'Chain Contract Address', value: 'chain_contract_address' },
                                        { text: 'Origin ChainId', value: 'origin_chain_id' }
                                    ]"
                                    :items="tokens"
                                    :loading="isLoadingTokens"
                                    :options.sync="tableOptions"
                                    :server-items-length="totalItems"
                                    :footer-props="{
                                        'items-per-page-options': [5, 10, 20, 50],
                                        showFirstLastPage: true
                                    }"
                                >
                                </v-data-table>
                            </v-card-text>
                        </v-card>
                    </v-col>
                </v-row>

                <!-- Add Token Dialog -->
                <v-dialog v-model="showAddTokenDialog" max-width="500px">
                    <v-card>
                        <v-card-title>Add New Token</v-card-title>
                        <v-card-text>
                            <v-form ref="tokenForm">
                                <v-text-field
                                    v-model="newToken.name"
                                    label="Name"
                                    required
                                    :rules="[v => !!v || 'Name is required']"
                                ></v-text-field>
                                <v-text-field
                                    v-model="newToken.symbol"
                                    label="Symbol"
                                    required
                                    :rules="[v => !!v || 'Symbol is required']"
                                ></v-text-field>
                                <v-text-field
                                    v-model="newToken.denom"
                                    label="Denom"
                                    required
                                    :rules="[v => !!v || 'Denom is required']"
                                ></v-text-field>
                                <v-text-field
                                    v-model.number="newToken.decimals"
                                    label="Decimals"
                                    type="number"
                                    required
                                    :rules="[
                                        v => !!v || 'Decimals is required',
                                        v => v >= 0 || 'Decimals must be non-negative'
                                    ]"
                                ></v-text-field>
                            </v-form>
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn color="error" text @click="showAddTokenDialog = false">Cancel</v-btn>
                            <v-btn 
                                color="primary" 
                                @click="deployToken"
                                :loading="isDeployingToken"
                            >
                                Deploy
                            </v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>
            </v-container>

            <!-- Settings Page -->
            <v-container v-else-if="showSettingsPage">
                <v-row>
                    <v-col cols="12">
                        <v-card>
                            <v-card-title>
                                Chain {{ selectedChainId }} Settings
                                <v-spacer></v-spacer>
                                <v-btn color="primary" @click="updateSettings" :loading="isUpdatingSettings">
                                    Update
                                </v-btn>
                                <v-btn color="secondary" class="ml-2" @click="showSettingsPage = false">
                                    Back to Chains
                                </v-btn>
                            </v-card-title>
                            <v-card-text>
                                <v-textarea
                                    v-model="chainSettings"
                                    label="Settings"
                                    auto-grow
                                    rows="20"
                                    :error-messages="settingsError"
                                    @input="validateJson"
                                ></v-textarea>
                            </v-card-text>
                        </v-card>
                    </v-col>
                </v-row>
            </v-container>

            <!-- Governance Page -->
            <v-container v-else-if="showGovernancePage">
                <v-row>
                    <v-col cols="12">
                        <v-card>
                            <v-card-title>
                                Governance
                                <v-spacer></v-spacer>
                                <v-btn color="secondary" class="ml-2" @click="showGovernancePage = false">
                                    Back to Chains
                                </v-btn>
                            </v-card-title>
                            <v-card-text>
                                <v-data-table
                                    :headers="[
                                        { text: 'Proposal ID', value: 'id' },
                                        { text: 'Title', value: 'title' },
                                        { text: 'Status', value: 'status' },
                                        { text: 'Yes Votes', value: 'yes_count' },
                                        { text: 'No Votes', value: 'no_count' },
                                        { text: 'Actions', value: 'actions', sortable: false },
                                    ]"
                                    :items="governanceProposals"
                                    :loading="isLoadingGovernanceProposals"
                                    :options.sync="governanceTableOptions"
                                    :server-items-length="totalProposals"
                                    :footer-props="{
                                        'items-per-page-options': [5, 10, 20, 50],
                                        showFirstLastPage: true
                                    }"
                                >
                                    <template v-slot:item.id="{ item }">
                                        <v-tooltip bottom>
                                            <template v-slot:activator="{ on, attrs }">
                                                <span v-bind="attrs" v-on="on">{{ item.id }}</span>
                                            </template>
                                            <v-btn
                                                text
                                                small
                                                @click="copyToClipboard(item.id)"
                                            >
                                                Click to copy
                                            </v-btn>
                                        </v-tooltip>
                                    </template>
                                    <template v-slot:item.status="{ item }">
                                        <v-chip :color="item.status === 'VOTING_PERIOD' ? 'success' : 'info'">
                                            {{ item.status }}
                                        </v-chip>
                                    </template>
                                    <template v-slot:item.actions="{ item }">
                                        <v-btn
                                            color="success"
                                            small
                                            @click="voteForProposal(item.id, 'yes')"
                                            :loading="voteLoading[item.id] === true"
                                            :disabled="item.voted || voteLoading[item.id] === true"
                                            class="mr-2"
                                        >
                                            Vote Yes
                                        </v-btn>
                                        <v-btn
                                            color="error"
                                            small
                                            @click="voteForProposal(item.id, 'no')"
                                            :loading="voteLoading[item.id] === true"
                                            :disabled="item.voted || voteLoading[item.id] === true"
                                        >
                                            Vote No
                                        </v-btn>
                                        <span v-if="item.voted" class="ml-2 grey--text">Voted {{ item.vote_option }}</span>
                                    </template>
                                </v-data-table>
                            </v-card-text>
                        </v-card>
                    </v-col>
                </v-row>

                <!-- Proposal Details Dialog -->
                <v-dialog v-model="showProposalDetailsDialog" max-width="800px">
                    <v-card>
                        <v-card-title>Proposal Details</v-card-title>
                        <v-card-text>
                            <v-container fluid>
                                <v-row>
                                    <v-col cols="12" md="6">
                                        <p><strong>Proposal ID:</strong> {{ currentProposalDetails.proposal_id }}</p>
                                        <p><strong>Title:</strong> {{ currentProposalDetails.title }}</p>
                                        <p><strong>Description:</strong> {{ currentProposalDetails.description }}</p>
                                        <p><strong>Status:</strong> {{ currentProposalDetails.status }}</p>
                                        <p><strong>Created At:</strong> {{ currentProposalDetails.created_at }}</p>
                                        <p><strong>Voting Start:</strong> {{ currentProposalDetails.voting_start }}</p>
                                        <p><strong>Voting End:</strong> {{ currentProposalDetails.voting_end }}</p>
                                        <p><strong>Total Votes:</strong> {{ currentProposalDetails.total_votes }}</p>
                                        <p><strong>Yes Votes:</strong> {{ currentProposalDetails.yes_votes }}</p>
                                        <p><strong>No Votes:</strong> {{ currentProposalDetails.no_votes }}</p>
                                        <p><strong>Abstain Votes:</strong> {{ currentProposalDetails.abstain_votes }}</p>
                                    </v-col>
                                    <v-col cols="12" md="6">
                                        <p><strong>Proposer:</strong> {{ currentProposalDetails.proposer }}</p>
                                        <p><strong>Deposit:</strong> {{ currentProposalDetails.deposit }}</p>
                                        <p><strong>Deposit Token:</strong> {{ currentProposalDetails.deposit_token }}</p>
                                        <p><strong>Proposal Type:</strong> {{ currentProposalDetails.proposal_type }}</p>
                                        <p><strong>Deposit End:</strong> {{ currentProposalDetails.deposit_end }}</p>
                                        <p><strong>Final Tally:</strong> {{ currentProposalDetails.final_tally }}</p>
                                        <p><strong>Final Result:</strong> {{ currentProposalDetails.final_result }}</p>
                                        <p><strong>Finalization Time:</strong> {{ currentProposalDetails.finalization_time }}</p>
                                    </v-col>
                                </v-row>
                            </v-container>
                        </v-card-text>
                        <v-card-actions>
                            <v-spacer></v-spacer>
                            <v-btn color="error" text @click="showProposalDetailsDialog = false">Close</v-btn>
                        </v-card-actions>
                    </v-card>
                </v-dialog>
            </v-container>

            <!-- Snackbar for notifications -->
            <v-snackbar
                v-model="snackbar.show"
                :color="snackbar.color"
                :timeout="3000"
            >
                {{ snackbar.text }}
                <template v-slot:action="{ attrs }">
                    <v-btn
                        text
                        v-bind="attrs"
                        @click="snackbar.show = false"
                    >
                        Close
                    </v-btn>
                </template>
            </v-snackbar>
        </v-app>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.x/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script>
        new Vue({
            el: '#app',
            vuetify: new Vuetify(),
            data: {
                isAuthenticated: false,
                password: '',
                showPassword: false,
                error: null,
                chains: {},
                showAddChainDialog: false,
                showProposeDialog: false,
                showTokensPage: false,
                showRpcsPage: false,
                showSettingsPage: false,
                showAddTokenDialog: false,
                showAddRpcsDialog: false,
                selectedChainId: null,
                newChainId: '',
                isProposing: false,
                isAddingChain: false,
                isDeployingToken: false,
                isLoadingTokens: false,
                isLoadingRpcs: false,
                isAddingRpcs: false,
                isDeletingRpc: null,
                isSettingPrimaryRpc: null,
                isLoadingTransactions: false,
                isUpdatingSettings: false,
                isCreatingHyperionContract: false,
                tokens: [],
                rpcs: [],
                staticRpcs: [],
                transactions: [],
                tableOptions: {},
                transactionTableOptions: {},
                totalItems: 0,
                totalTransactions: 0,
                newToken: {
                    name: '',
                    symbol: '',
                    denom: '',
                    decimals: 18
                },
                proposeForm: {
                    title: '',
                    description: '',
                    bridge_chain_id: null,
                    bridge_chain_name: '',
                    average_counterparty_block_time: 12000
                },
                showProposeUpdateDialog: false,
                isProposingUpdate: false,
                showOthersModal: false,
                snackbar: {
                    show: false,
                    text: '',
                    color: 'success'
                },
                walletAddress: '',
                newRpcs: '',
                isPrimary: false,
                chainSettings: '',
                settingsError: '',
                statsInterval: null,
                stats: {},
                showGovernancePage: false,
                governanceProposals: [],
                isLoadingGovernanceProposals: false,
                governanceTableOptions: {
                    page: 1,
                    itemsPerPage: 10,
                },
                totalProposals: 0,
                showProposalDetailsDialog: false,
                currentProposalDetails: {},
                hasVoted: {},
                voteLoading: {},
                showProposeAddWhitelistedAddressDialog: false,
                isProposingAddWhitelistedAddress: false,
                proposeAddWhitelistedAddressForm: {
                    title: '',
                    description: '',
                    chain_id: null,
                    address: '',
                },
                showUpdateChainLogoDialog: false,
                updateChainLogoHash: '',
            },
            mounted() {
                const storedPassword = localStorage.getItem('password');
                if (storedPassword) {
                    this.isAuthenticated = true;
                    this.fetchChains();
                    this.fetchTransactions();
                    this.fetchWalletAddress();
                    this.startStatsInterval();
                }
            },
            beforeDestroy() {
                this.stopStatsInterval();
            },
            watch: {
                tableOptions: {
                    handler() {
                        if (this.selectedChainId) {
                            this.viewTokens(this.selectedChainId);
                        }
                    },
                    deep: true
                },
                transactionTableOptions: {
                    handler() {
                        this.fetchTransactions();
                    },
                    deep: true
                },
                showGovernancePage: {
                    handler(newValue) {
                        if (newValue) {
                            this.fetchProposals();
                        }
                    },
                    immediate: false,
                },
            },
            methods: {
                showNotification(text, color = 'success') {
                    this.snackbar.text = text;
                    this.snackbar.color = color;
                    this.snackbar.show = true;
                },
                async viewTokens(chainId) {
                    this.selectedChainId = chainId;
                    this.showTokensPage = true;
                    this.tokens = [];
                    this.isLoadingTokens = true;

                    try {
                        const page = this.tableOptions.page || 1;
                        const itemsPerPage = this.tableOptions.itemsPerPage || 10;
                        
                        const response = await fetch(`/api/query?type=get-list-tokens&chain_id=${chainId}&page=${page}&size=${itemsPerPage}`);
                        if (!response.ok) {
                            throw new Error('Failed to fetch tokens');
                        }

                        const data = await response.json();
                        if (data.success && data.data.tokens) {
                            this.tokens = data.data.tokens.map(token => {
                                const chainMetadata = token.metadata.chainsMetadatas.find(x => x.chainId == chainId);

                                let originChainId = 42000;
                                const originMetadata = token.metadata.chainsMetadatas.find(x => x.isOriginated === true);

                                if (originMetadata) {
                                    originChainId = originMetadata.chainId;
                                }

                                return {
                                    name: token.metadata.name,
                                    symbol: token.metadata.symbol,
                                    decimals: token.metadata.decimals,
                                    contract_address: token.metadata.contract_address,
                                    chain_contract_address: chainMetadata?.contractAddress || 'N/A',
                                    origin_chain_id: originChainId,
                                }
                        });
                            this.totalItems = data.data.total;
                        }
                    } catch (error) {
                        console.error('Error fetching tokens:', error);
                        this.showNotification('Failed to fetch tokens', 'error');
                    } finally {
                        this.isLoadingTokens = false;
                    }
                },
                async deployToken() {
                    if (!this.$refs.tokenForm.validate()) {
                        return;
                    }

                    this.isDeployingToken = true;
                    try {
                        const response = await fetch('/api/query?type=deploy-erc20', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                chain_id: this.selectedChainId,
                                name: this.newToken.name,
                                symbol: this.newToken.symbol,
                                denom: this.newToken.denom,
                                decimals: this.newToken.decimals
                            }),
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to deploy token');
                        }

                        this.showAddTokenDialog = false;
                        this.newToken = {
                            name: '',
                            symbol: '',
                            denom: '',
                            decimals: 18
                        };
                        this.showNotification('Token deployed successfully');
                        // TODO: Refresh tokens list when API endpoint is available
                    } catch (error) {
                        console.error('Error deploying token:', error);
                        this.showNotification(error.message, 'error');
                    } finally {
                        this.isDeployingToken = false;
                    }
                },
                async login() {
                    try {
                        const response = await fetch('/api/query?type=login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ password: this.password }),
                        });

                        if (!response.ok) {
                            throw new Error('Invalid password');
                        }

                        localStorage.setItem('password', this.password);
                        this.isAuthenticated = true;
                        this.error = null;
                        this.fetchChains();
                        this.startStatsInterval();
                    } catch (error) {
                        this.error = error.message;
                    }
                },
                async fetchChains() {
                    try {
                        const response = await fetch('/api/query?type=get-list-hyperions');
                        if (!response.ok) {
                            throw new Error('Failed to fetch chains');
                        }
                        const resp = await response.json();
                        
                        // Fetch stats to get height information
                        await this.fetchStats();
                        
                        // Add isLoading property to each chain and sync status
                        this.chains = [];
                        Object.keys(resp.data).forEach(key => {
                            let chain = resp.data[key];
                            const chainStats = this.stats[key] || {};
                            const height = chainStats.height || 0;
                            const targetHeight = chainStats.targetHeight || 0;
                            const heightDiff = Math.abs(targetHeight - height);
                            const isSynced = heightDiff <= 1000;
                            chain.states = [];

                            Object.keys(chainStats.hyperionState ?? {}).forEach(key => {
                                if (!key.includes("Status")) {
                                    return;
                                }
                                chain.states.push({
                                    name: key.replace("Status", ""),
                                    value: chainStats.hyperionState[key],
                                    nextExecutionTimestamp: chainStats.hyperionState[key.replace("Status", "") + "NextExecutionTimestamp"] ? this.timeSinceString(chainStats.hyperionState[key.replace("Status", "") + "NextExecutionTimestamp"]) : 'N/A',
                                    lastExecutionFinishedTimestamp: chainStats.hyperionState[key.replace("Status", "") + "LastExecutionFinishedTimestamp"] ? this.timeSinceString(chainStats.hyperionState[key.replace("Status", "") + "LastExecutionFinishedTimestamp"]) : 'N/A'
                                });
                            });
                            
                            this.chains.push({
                                ...chain,
                                isLoading: false,
                                height: height,
                                targetHeight: targetHeight,
                                isSynced: isSynced,
                                heightDiff: heightDiff,
                                totalTxs: chainStats.totalTxs || 0,
                                batches: chainStats.batches || 0,
                                outBridgedTxCount: chainStats.outBridgedTxCount || 0,
                                inBridgedTxCount: chainStats.inBridgedTxCount || 0
                            });
                        });

                    } catch (error) {
                        console.error('Error fetching chains:', error);
                        this.showNotification('Failed to fetch chains', 'error');
                    }
                },
                async fetchStats() {
                    try {
                        const statsResponse = await fetch('/api/query?type=get-stats');
                        if (statsResponse.ok) {
                            const statsData = await statsResponse.json();
                            if (statsData.success && statsData.data) {
                                this.stats = statsData.data;
                                // Update existing chains with new stats
                                this.updateChainsWithStats();
                            }
                        }
                    } catch (error) {
                        console.error('Error fetching stats:', error);
                    }
                },
                updateChainsWithStats() {
                    this.chains.forEach(chain => {
                        const chainStats = this.stats[chain.chainId] || {};
                        const height = chainStats.height || 0;
                        const targetHeight = chainStats.targetHeight || 0;
                        const heightDiff = Math.abs(targetHeight - height);
                        const isSynced = heightDiff <= 1000;
                        
                        chain.height = height;
                        chain.targetHeight = targetHeight;
                        chain.isSynced = isSynced;
                        chain.heightDiff = heightDiff;
                        chain.totalTxs = chainStats.totalTxs || 0;
                        chain.batches = chainStats.batches || 0;
                        chain.outBridgedTxCount = chainStats.outBridgedTxCount || 0;
                        chain.inBridgedTxCount = chainStats.inBridgedTxCount || 0;
                        
                        // Update states
                        chain.states = [];
                        Object.keys(chainStats.hyperionState ?? {}).forEach(key => {
                            if (!key.includes("Status")) {
                                return;
                            }
                            chain.states.push({
                                name: key.replace("Status", ""),
                                value: chainStats.hyperionState[key],
                                nextExecutionTimestamp: chainStats.hyperionState[key.replace("Status", "") + "NextExecutionTimestamp"] ? this.timeSinceString(chainStats.hyperionState[key.replace("Status", "") + "NextExecutionTimestamp"]) : 'N/A',
                                lastExecutionFinishedTimestamp: chainStats.hyperionState[key.replace("Status", "") + "LastExecutionFinishedTimestamp"] ? this.timeSinceString(chainStats.hyperionState[key.replace("Status", "") + "LastExecutionFinishedTimestamp"]) : 'N/A'
                            });
                        });
                    });
                },
                startStatsInterval() {
                    // Clear any existing interval
                    if (this.statsInterval) {
                        clearInterval(this.statsInterval);
                    }
                    // Start new interval to fetch stats every 20 seconds
                    this.statsInterval = setInterval(() => {
                        this.fetchStats();
                    }, 1000);
                },
                timeSinceString(timestamp) {
                    const now = new Date();
                    const then = new Date(timestamp * 1000);
                    const diff = now.getTime() - then.getTime();
                    const diffInSeconds = Math.floor(diff / 1000);
                    const diffInMinutes = Math.floor(diffInSeconds / 60);
                    const diffInHours = Math.floor(diffInMinutes / 60);
                    const diffInDays = Math.floor(diffInHours / 24);
                    const diffInMonths = Math.floor(diffInDays / 30);
                    const diffInYears = Math.floor(diffInDays / 365);

                    if (diffInYears > 0) {
                        return diffInYears + 'y ' + diffInMonths + 'mo ' + diffInDays + 'd ' + diffInHours + 'h ' + diffInMinutes + 'm ' + diffInSeconds + 's';
                    } else if (diffInMonths > 0) {
                        return diffInMonths + 'mo ' + diffInDays + 'd ' + diffInHours + 'h ' + diffInMinutes + 'm ' + diffInSeconds + 's';
                    } else if (diffInDays > 0) {
                        return diffInDays + 'd ' + diffInHours + 'h ' + diffInMinutes + 'm ' + diffInSeconds + 's';
                    } else if (diffInHours > 0) {
                        return diffInHours + 'h ' + diffInMinutes + 'm ' + diffInSeconds + 's';
                    } else if (diffInMinutes > 0) {
                        return diffInMinutes + 'm ' + diffInSeconds + 's';
                    } else {
                        return diffInSeconds + 's';
                    }
                    return 'N/A';
                },
                stopStatsInterval() {
                    if (this.statsInterval) {
                        clearInterval(this.statsInterval);
                        this.statsInterval = null;
                    }
                },
                async runHyperion(chainId) {
                    try {
                        // Set loading state
                        this.chains.find(chain => chain.chainId === chainId).isLoading = true;

                        const response = await fetch('/api/query?type=run-hyperion', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ chain_id: chainId }),
                        });

                        if (!response.ok) {
                            throw new Error('Failed to run Hyperion');
                        }

                        // Show success message
                        this.showNotification(`Hyperion started successfully for chain ${chainId}`);
                        
                        // Refresh the chains list
                        await this.fetchChains();
                    } catch (error) {
                        console.error('Error running Hyperion:', error);
                        this.showNotification(`Failed to run Hyperion: ${error.message}`, 'error');
                    } finally {
                        // Clear loading state if the chain still exists
                        if (this.chains.find(chain => chain.chainId === chainId)) {
                            this.chains.find(chain => chain.chainId === chainId).isLoading = false;
                        }
                    }
                },
                async stopHyperion(chainId) {
                    try {
                        // Set loading state
                        this.chains.find(chain => chain.chainId === chainId).isLoading = true;

                        const response = await fetch('/api/query?type=stop-hyperion', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ chain_id: chainId }),
                        });

                        if (!response.ok) {
                            throw new Error('Failed to stop Hyperion');
                        }

                        // Show success message
                        this.showNotification(`Hyperion stopped successfully for chain ${chainId}`);
                        
                        // Refresh the chains list
                        await this.fetchChains();
                    } catch (error) {
                        console.error('Error stopping Hyperion:', error);
                        this.showNotification(`Failed to stop Hyperion: ${error.message}`, 'error');
                    } finally {
                        // Clear loading state if the chain still exists
                        if (this.chains.find(chain => chain.chainId === chainId)) {
                            this.chains.find(chain => chain.chainId === chainId).isLoading = false;
                        }
                    }
                },
                async addNewChain() {
                    if (!this.newChainId) {
                        this.showNotification('Please enter a Chain ID', 'error');
                        return;
                    }

                    this.isAddingChain = true;
                    try {
                        const response = await fetch('/api/query?type=add-new-chain', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ chain_id: Number(this.newChainId) }),
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to add new chain');
                        }

                        this.showAddChainDialog = false;
                        this.newChainId = '';
                        this.showNotification('New chain added successfully');
                        await this.fetchChains();
                    } catch (error) {
                        console.error('Error adding new chain:', error);
                        this.showNotification(error.message, 'error');
                    } finally {
                        this.isAddingChain = false;
                    }
                },
                openProposeDialog(chainId) {
                    this.proposeForm = {
                        title: '',
                        description: '',
                        bridge_chain_id: chainId,
                        bridge_chain_name: '',
                        average_counterparty_block_time: 12000
                    };
                    this.showProposeDialog = true;
                },
                async proposeHyperion() {
                    if (!this.$refs.proposeForm.validate()) {
                        return;
                    }

                    this.isProposing = true;
                    try {
                        const response = await fetch('/api/query?type=propose-hyperion', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                title: this.proposeForm.title,
                                description: this.proposeForm.description,
                                bridge_chain_id: Number(this.proposeForm.bridge_chain_id),
                                bridge_chain_name: this.proposeForm.bridge_chain_name,
                                average_counterparty_block_time: Number(this.proposeForm.average_counterparty_block_time)
                            }),
                        });

                        if (!response.ok) {
                            throw new Error('Failed to propose Hyperion');
                        }

                        this.showProposeDialog = false;
                        this.showNotification('Hyperion proposed successfully');
                        await this.fetchChains();
                    } catch (error) {
                        console.error('Error proposing Hyperion:', error);
                        this.showNotification(`Failed to propose Hyperion: ${error.message}`, 'error');
                    } finally {
                        this.isProposing = false;
                    }
                },
                openProposeUpdateDialog(chainId) {
                    this.proposeForm = {
                        title: '',
                        description: '',
                        bridge_chain_id: chainId,
                        bridge_chain_name: '',
                        average_counterparty_block_time: 12000
                    };
                    this.showProposeUpdateDialog = true;
                },
                async proposeHyperionUpdate() {
                    if (!this.$refs.proposeUpdateForm.validate()) {
                        return;
                    }

                    this.isProposingUpdate = true;
                    try {
                        const response = await fetch('/api/query?type=propose-hyperion-update', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                title: this.proposeForm.title,
                                description: this.proposeForm.description,
                                bridge_chain_id: Number(this.proposeForm.bridge_chain_id),
                                bridge_chain_name: this.proposeForm.bridge_chain_name,
                                average_counterparty_block_time: Number(this.proposeForm.average_counterparty_block_time)
                            }),
                        });

                        if (!response.ok) {
                            throw new Error('Failed to propose Hyperion update');
                        }

                        this.showProposeUpdateDialog = false;
                        this.showNotification('Hyperion update proposed successfully');
                        await this.fetchChains();
                    } catch (error) {
                        console.error('Error proposing Hyperion update:', error);
                        this.showNotification(`Failed to propose Hyperion update: ${error.message}`, 'error');
                    } finally {
                        this.isProposingUpdate = false;
                    }
                },
                async unregisterHyperion(chainId) {
                    try {
                        // Find the chain and set its loading state
                        const chain = this.chains.find(chain => chain.chainId === chainId);
                        if (chain) {
                            chain.isLoading = true;
                        }

                        const response = await fetch('/api/query?type=unregister-hyperion', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ chain_id: chainId }),
                        });

                        if (!response.ok) {
                            throw new Error('Failed to unregister Hyperion');
                        }

                        this.showNotification(`Hyperion unregistered successfully for chain ${chainId}`);
                        await this.fetchChains();
                    } catch (error) {
                        console.error('Error unregistering Hyperion:', error);
                        this.showNotification(`Failed to unregister Hyperion: ${error.message}`, 'error');
                    } finally {
                        // Clear loading state if the chain still exists
                        const chain = this.chains.find(chain => chain.chainId === chainId);
                        if (chain) {
                            chain.isLoading = false;
                        }
                    }
                },
                async registerHyperion(chainId) {
                    try {
                        // Find the chain and set its loading state
                        const chain = this.chains.find(chain => chain.chainId === chainId);
                        if (chain) {
                            chain.isLoading = true;
                        }

                        const response = await fetch('/api/query?type=register-hyperion', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ chain_id: chainId }),
                        });

                        if (!response.ok) {
                            throw new Error('Failed to register Hyperion');
                        }

                        this.showNotification(`Hyperion registered successfully for chain ${chainId}`);
                        await this.fetchChains();
                    } catch (error) {
                        console.error('Error registering Hyperion:', error);
                        this.showNotification(`Failed to register Hyperion: ${error.message}`, 'error');
                    } finally {
                        // Clear loading state if the chain still exists
                        const chain = this.chains.find(chain => chain.chainId === chainId);
                        if (chain) {
                            chain.isLoading = false;
                        }
                    }
                },
                copyToClipboard(text) {
                    navigator.clipboard.writeText(text).then(() => {
                        this.showNotification('RPC URL copied to clipboard');
                    });
                },
                async viewRpcs(chainId) {
                    this.selectedChainId = chainId;
                    this.showRpcsPage = true;
                    this.rpcs = [];
                    this.isLoadingRpcs = true;

                    try {
                        const response = await fetch(`/api/query?type=get-list-rpcs&chain_id=${chainId}`);
                        if (!response.ok) {
                            throw new Error('Failed to fetch RPCs');
                        }

                        const data = await response.json();
                        if (data.success) {
                            this.rpcs = data.data;
                        }
                    } catch (error) {
                        console.error('Error fetching RPCs:', error);
                        this.showNotification('Failed to fetch RPCs', 'error');
                    } finally {
                        this.isLoadingRpcs = false;
                    }
                },
                async setPrimaryRpc(rpcUrl) {
                    this.isSettingPrimaryRpc = rpcUrl;
                    try {
                        const response = await fetch('/api/query?type=set-primary-rpc', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                chain_id: this.selectedChainId,
                                rpc_url: rpcUrl,
                            }),
                        });

                        if (!response.ok) {
                            throw new Error('Failed to set primary RPC');
                        }

                        this.showNotification('Primary RPC updated successfully');
                        await this.viewRpcs(this.selectedChainId);
                    } catch (error) {
                        console.error('Error setting primary RPC:', error);
                        this.showNotification(error.message, 'error');
                    } finally {
                        this.isSettingPrimaryRpc = null;
                    }
                },
                async fetchTransactions() {
                    if (!this.isAuthenticated) return;
                    
                    this.isLoadingTransactions = true;
                    try {
                        const page = this.transactionTableOptions.page || 1;
                        const itemsPerPage = this.transactionTableOptions.itemsPerPage || 10;
                        
                        const response = await fetch(`/api/query?type=get-list-transactions&page=${page}&size=${itemsPerPage}`);
                        if (!response.ok) {
                            throw new Error('Failed to fetch transactions');
                        }

                        const data = await response.json();
                        if (data.success && data.data.transactions) {
                            this.transactions = data.data.transactions.map(transaction => ({
                                ...transaction,
                                timestamp: new Date(transaction.timestamp * 1000).toLocaleString(),
                            }));
                            this.totalTransactions = data.data.total || this.transactions.length;
                        }
                    } catch (error) {
                        console.error('Error fetching transactions:', error);
                        this.showNotification('Failed to fetch transactions', 'error');
                    } finally {
                        this.isLoadingTransactions = false;
                    }
                },
                async fetchWalletAddress() {
                    try {
                        const response = await fetch('/api/query?type=get-wallet-address');
                        if (!response.ok) {
                            throw new Error('Failed to fetch wallet address');
                        }
                        const data = await response.json();
                        this.walletAddress = data.data.address;
                    } catch (error) {
                        console.error('Error fetching wallet address:', error);
                        this.showNotification('Failed to fetch wallet address', 'error');
                    }
                },
                async addRpcs() {
                    if (!this.$refs.rpcsForm.validate()) {
                        return;
                    }

                    this.isAddingRpcs = true;
                    try {
                        const rpcsArray = this.newRpcs.split('\n').map(rpc => rpc.trim()).filter(rpc => rpc);
                        const response = await fetch('/api/query?type=add-rpcs', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                chain_id: this.selectedChainId,
                                rpcs: rpcsArray.join(','),
                                is_primary: this.isPrimary,
                            }),
                        });

                        if (!response.ok) {
                            throw new Error('Failed to add RPCs');
                        }

                        this.showAddRpcsDialog = false;
                        this.newRpcs = '';
                        this.isPrimary = false;
                        this.showNotification('RPCs added successfully');
                        await this.viewRpcs(this.selectedChainId);
                    } catch (error) {
                        console.error('Error adding RPCs:', error);
                        this.showNotification(error.message, 'error');
                    } finally {
                        this.isAddingRpcs = false;
                    }
                },
                async removeRpc(rpc) {
                    this.isDeletingRpc = rpc;
                    try {
                        const response = await fetch('/api/query?type=remove-rpcs', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                chain_id: this.selectedChainId,
                                rpcs: rpc
                            }),
                        });

                        if (!response.ok) {
                            throw new Error('Failed to remove RPC');
                        }

                        this.showNotification('RPC removed successfully');
                        await this.viewRpcs(this.selectedChainId);
                    } catch (error) {
                        console.error('Error removing RPC:', error);
                        this.showNotification(error.message, 'error');
                    } finally {
                        this.isDeletingRpc = null;
                    }
                },
                async createHyperionContract(chainId) {
                    this.isCreatingHyperionContract = true;
                    try {
                        const response = await fetch('/api/query?type=deploy-hyperion-contract', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ chain_id: chainId }),
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to create Hyperion contract');
                        }

                        this.showNotification('Hyperion contract created successfully');
                        await this.fetchWalletAddress(); // Refresh wallet address to get the new contract address
                        await this.fetchChains();
                    } catch (error) {
                        console.error('Error creating Hyperion contract:', error);
                        this.showNotification(error.message, 'error');
                    } finally {
                        this.isCreatingHyperionContract = false;
                    }
                },
                async viewSettings(chainId) {
                    this.selectedChainId = chainId;
                    this.showSettingsPage = true;
                    this.chainSettings = '';
                    this.settingsError = '';

                    try {
                        const response = await fetch(`/api/query?type=get-chain-settings&chain_id=${chainId}`);
                        if (!response.ok) {
                            throw new Error('Failed to fetch chain settings');
                        }

                        const data = await response.json();
                        if (data.success) {
                            // Format the JSON with proper indentation
                            this.chainSettings = JSON.stringify(data.data, null, 2);
                        }
                    } catch (error) {
                        console.error('Error fetching chain settings:', error);
                        this.showNotification('Failed to fetch chain settings', 'error');
                    }
                },
                validateJson() {
                    try {
                        JSON.parse(this.chainSettings);
                        this.settingsError = '';
                        return true;
                    } catch (error) {
                        this.settingsError = 'Invalid JSON format';
                        return false;
                    }
                },
                async updateSettings() {
                    if (!this.validateJson()) {
                        this.showNotification('Invalid JSON format', 'error');
                        return;
                    }

                    this.isUpdatingSettings = true;
                    try {
                        const response = await fetch('/api/query?type=update-chain-settings', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                chain_id: this.selectedChainId,
                                settings: JSON.parse(this.chainSettings)
                            }),
                        });

                        if (!response.ok) {
                            throw new Error('Failed to update chain settings');
                        }

                        this.showNotification('Settings updated successfully');
                    } catch (error) {
                        console.error('Error updating chain settings:', error);
                        this.showNotification(error.message, 'error');
                    } finally {
                        this.isUpdatingSettings = false;
                    }
                },
                async fetchGovernanceProposals() {
                    this.isLoadingGovernanceProposals = true;
                    try {
                        const response = await fetch(`/api/query?type=get-list-governance-proposals&chain_id=${this.selectedChainId}`);
                        if (!response.ok) {
                            throw new Error('Failed to fetch governance proposals');
                        }
                        const data = await response.json();
                        if (data.success && data.data.proposals) {
                            this.governanceProposals = data.data.proposals.map(proposal => ({
                                id: proposal.id,
                                title: proposal.title,
                                status: proposal.status,
                                yes_count: proposal.currentTallyResult.yes_count,
                                no_count: proposal.currentTallyResult.no_count,
                                abstain_count: proposal.currentTallyResult.abstain_count,
                                no_with_veto_count: proposal.currentTallyResult.no_with_veto_count,
                                voted: localStorage.getItem(`voted_proposal_${proposal.id}`) === 'true',
                                vote_option: localStorage.getItem(`vote_option_${proposal.id}`),
                            }));
                            this.totalProposals = data.data.total;
                        }
                    } catch (error) {
                        console.error('Error fetching governance proposals:', error);
                        this.showNotification('Failed to fetch governance proposals', 'error');
                    } finally {
                        this.isLoadingGovernanceProposals = false;
                    }
                },
                async viewProposalDetails(proposalId) {
                    this.showProposalDetailsDialog = true;
                    this.currentProposalDetails = {};
                    try {
                        const response = await fetch(`/api/query?type=get-governance-proposal-details&proposal_id=${proposalId}`);
                        if (!response.ok) {
                            throw new Error('Failed to fetch proposal details');
                        }
                        const data = await response.json();
                        if (data.success && data.data) {
                            this.currentProposalDetails = data.data;
                        }
                    } catch (error) {
                        console.error('Error fetching proposal details:', error);
                        this.showNotification('Failed to fetch proposal details', 'error');
                    }
                },
                async fetchProposals() {
                    this.isLoadingGovernanceProposals = true;
                    try {
                        const page = this.governanceTableOptions.page;
                        const itemsPerPage = this.governanceTableOptions.itemsPerPage;
                        const response = await fetch(`/api/query?type=get-list-proposals&page=${page}&size=${itemsPerPage}`);
                        if (!response.ok) {
                            throw new Error('Failed to fetch proposals');
                        }
                        const data = await response.json();
                        if (data.success && data.data.proposals) {
                            this.governanceProposals = data.data.proposals.map(proposal => ({
                                id: proposal.id,
                                title: proposal.title,
                                status: proposal.status,
                                yes_count: proposal.currentTallyResult.yes_count,
                                no_count: proposal.currentTallyResult.no_count,
                                abstain_count: proposal.currentTallyResult.abstain_count,
                                no_with_veto_count: proposal.currentTallyResult.no_with_veto_count,
                                voted: localStorage.getItem(`voted_proposal_${proposal.id}`) === 'true',
                                vote_option: localStorage.getItem(`vote_option_${proposal.id}`),
                            }));
                            this.totalProposals = data.data.total;
                        }
                    } catch (error) {
                        console.error('Error fetching proposals:', error);
                        this.showNotification('Failed to fetch proposals', 'error');
                    } finally {
                        this.isLoadingGovernanceProposals = false;
                    }
                },
                async voteForProposal(proposalId, voteOption) {
                    this.$set(this.voteLoading, proposalId, true);
                    try {
                        const response = await fetch('/api/query?type=vote-for-proposal', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                proposal_id: proposalId,
                                vote_option: voteOption,
                            }),
                        });
 
                        if (!response.ok) {
                            throw new Error('Failed to cast vote');
                        }
 
                        const data = await response.json();
                        if (data.success) {
                            localStorage.setItem(`voted_proposal_${proposalId}`, 'true');
                            localStorage.setItem(`vote_option_${proposalId}`, voteOption);
                            this.$set(this.hasVoted, proposalId, true);
                            this.showNotification(`Successfully voted ${voteOption} for proposal ${proposalId}`);
                            this.fetchProposals(); // Refresh the proposals list to update vote counts
                        } else {
                            throw new Error(data.error || 'Failed to cast vote');
                        }
                    } catch (error) {
                        console.error('Error casting vote:', error);
                        this.showNotification(error.message, 'error');
                    } finally {
                        this.$set(this.voteLoading, proposalId, false);
                    }
                },
                openProposeAddWhitelistedAddressDialog(chainId) {
                    this.proposeAddWhitelistedAddressForm = {
                        title: '',
                        description: '',
                        chain_id: chainId,
                        address: '',
                    };
                    this.showProposeAddWhitelistedAddressDialog = true;
                },
                async proposeAddWhitelistedAddress() {
                    if (!this.$refs.proposeAddWhitelistedAddressForm.validate()) {
                        return;
                    }

                    this.isProposingAddWhitelistedAddress = true;
                    try {
                        const response = await fetch('/api/query?type=propose-add-whitelisted-address', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                title: this.proposeAddWhitelistedAddressForm.title,
                                description: this.proposeAddWhitelistedAddressForm.description,
                                chain_id: Number(this.proposeAddWhitelistedAddressForm.chain_id),
                                address: this.proposeAddWhitelistedAddressForm.address,
                            }),
                        });

                        if (!response.ok) {
                            throw new Error('Failed to propose add whitelisted address');
                        }

                        this.showProposeAddWhitelistedAddressDialog = false;
                        this.showNotification('Whitelisted address proposed successfully');
                        await this.fetchChains();
                    } catch (error) {
                        console.error('Error proposing add whitelisted address:', error);
                        this.showNotification(`Failed to propose add whitelisted address: ${error.message}`, 'error');
                    } finally {
                        this.isProposingAddWhitelistedAddress = false;
                    }
                },
                openUpdateChainLogoDialog(chainId) {
                    this.selectedChainId = chainId;
                    this.updateChainLogoHash = ''; // Clear previous hash
                    this.showUpdateChainLogoDialog = true;
                },
                async updateChainLogo() {
                    if (!this.selectedChainId || !this.updateChainLogoHash) {
                        this.showNotification('Please select a Chain ID and enter a Logo Hash', 'error');
                        return;
                    }

                    try {
                        const response = await fetch('/api/query?type=update-chain-logo', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                chain_id: this.selectedChainId,
                                logo: this.updateChainLogoHash,
                            }),
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.error || 'Failed to update chain logo');
                        }

                        this.showUpdateChainLogoDialog = false;
                        this.selectedChainId = null;
                        this.updateChainLogoHash = '';
                        this.showNotification('Chain logo updated successfully');
                        await this.fetchChains(); // Refresh chains to show updated logo
                    } catch (error) {
                        console.error('Error updating chain logo:', error);
                        this.showNotification(error.message, 'error');
                    }
                },
            },
        });
    </script>
</body>
</html> 